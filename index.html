<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Synergy Tao – Directory</title>
<meta name="description" content="Community directory of holistic & complementary services in Telford and Shropshire: Qigong, Wing Chun, massage, counselling, yoga, and more." />
<style>
  :root{--green:#2F6E4E;--leaf:#65B089;--soft:#F6F7F6;--ink:#222}
  *{box-sizing:border-box}
  body{margin:0;background:#fff;color:var(--ink);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif}
  .dir-wrap{max-width:1100px;margin:0 auto;padding:28px 16px}
  .dir-wrap h1{margin:0 0 6px;font-size:clamp(24px,3.5vw,36px)}
  .dir-lead{color:#444;margin:0 0 18px}
  .dir-controls{display:grid;gap:10px;margin:12px 0 16px}
  .dir-search{display:flex;gap:8px;align-items:center;justify-content:center}
  .dir-input{flex:1;max-width:540px;padding:12px 14px;border:1px solid #ddd;border-radius:10px;background:#fff}
  .dir-btn{padding:12px 14px;border-radius:10px;border:2px solid var(--green);background:var(--green);color:#fff;font-weight:700;cursor:pointer}
  .chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:6px 0}
  .chip{padding:6px 10px;border-radius:999px;background:var(--soft);border:1px solid #e7e7e7;cursor:pointer;font-size:13px}
  .chip.active{background:var(--leaf);border-color:var(--leaf);color:#083;font-weight:700}
  .count{font-size:13px;color:#555;text-align:center;margin:6px 0 8px}
  .grid{display:grid;gap:14px;grid-template-columns:1fr}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  @media(min-width:1024px){.grid{grid-template-columns:1fr 1fr 1fr}}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:16px;display:flex;flex-direction:column}
  .thumb{width:100%;max-height:160px;border-radius:10px;margin-bottom:10px;background:#f4f4f4;display:block}
  .thumb.logo{object-fit:contain;padding:10px;background:#fff}
  .thumb.photo{object-fit:cover}
  .card h3{margin:0 0 6px;font-size:18px}
  .meta{font-size:13px;color:#666;margin-top:4px}
  .tagrow{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
  .tag{font-size:12px;background:#eef7f1;border:1px solid #d8eee2;color:#225f45;border-radius:999px;padding:4px 8px}
  .actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .link{padding:8px 10px;border-radius:8px;border:1px solid #ddd;text-decoration:none;color:#174e36;background:#fff}
  .link:hover{border-color:var(--leaf)}
  .socials{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .socials a{font-size:12px;color:#2b5f46;text-decoration:none;border-bottom:1px dotted #2b5f46}
  .empty{padding:16px;border:1px dashed #ddd;border-radius:12px;background:#fafafa;text-align:center}
  .error{padding:16px;border:1px solid #f5c2c7;background:#fff5f6;color:#8a1f2d;border-radius:12px}
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
  <div class="dir-wrap" id="sth-dir">
    <h1>Find a Practitioner or Service</h1>
    <p class="dir-lead">Search by name, service or town (e.g. “Massage Telford”, “Wing Chun Wellington”, “Qigong”). Use filters to narrow by category.</p>

    <div class="dir-controls">
      <div class="dir-search">
        <input id="sth-q" class="dir-input" type="search" placeholder="Search by name, service or town…" autocomplete="off" aria-label="Search directory">
        <button class="dir-btn" id="sth-clear" type="button">Clear</button>
      </div>
      <div class="chips" id="sth-chips"></div>
      <div class="count" id="sth-count"></div>
    </div>

    <div id="sth-msg"></div>
    <div class="grid" id="sth-list"></div>
    <div class="empty" id="sth-empty" style="display:none;">No results found. Try different keywords or clear filters.</div>
  </div>

  <!-- Directory Data (JSON) -->
  <script id="sth-data" type="application/json">
  [
    {
      "name": "Synergy Tao",
      "primaryService": "Wing Chun & Qigong",
      "tags": ["Holistic Martial Arts","Wing Chun","Qigong","Self-Defence","Meditation","Adults"],
      "image": "https://synergytaohub.co.uk/images/academies/17941/images/0d772f2be95d.png",
      "isLogo": true,
      "website": "https://synergytao.co.uk",
      "profile": "https://synergytaohub.co.uk/page/synergy-tao",
      "facebook": "https://www.facebook.com/synergytao",
      "instagram": "https://www.instagram.com/synergytao",
      "x": "",
      "tiktok": "",
      "bluesky": "",
      "youtube": "",
      "linkedin": "",
      "booking": "",
      "email": "mailto:sifudavid@synergytao.co.uk",
      "whatsapp": "https://wa.me/447956096359",
      "phone": "07956 096359",
      "location": "Telford"
    },
    {
      "name": "Business Name",
      "primaryService": "Main Service",
      "tags": ["Service 1", "Service 2", "Service 3"],
      "image": "https://synergytaohub.co.uk/images/academies/17941/images/your-image.jpg",
      "isLogo": false,
      "website": "https://example.com",
      "profile": "https://synergytaohub.co.uk/page/business-profile",
      "facebook": "https://facebook.com/",
      "instagram": "https://instagram.com/",
      "x": "https://x.com/",
      "tiktok": "https://tiktok.com/",
      "bluesky": "https://bsky.app/",
      "youtube": "https://youtube.com/",
      "linkedin": "https://linkedin.com/",
      "booking": "https://bookinglink.com",
      "email": "mailto:info@example.com",
      "whatsapp": "https://wa.me/447000000000",
      "phone": "07123 456789",
      "location": "Town, Shropshire"
    }
  ]
  </script>

  <script>
  (function(){
    const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
    const listEl=$("#sth-list"), emptyEl=$("#sth-empty"), countEl=$("#sth-count"), qEl=$("#sth-q"), chipsEl=$("#sth-chips"), clearBtn=$("#sth-clear"), msgEl=$("#sth-msg");

    // Parse JSON safely and show helpful error if needed
    let entries=[];
    try{
      const raw=$("#sth-data").textContent.trim();
      entries = JSON.parse(raw);
      if(!Array.isArray(entries)) throw new Error("Directory data must be a JSON array.");
    }catch(err){
      msgEl.innerHTML = '<div class="error"><strong>Directory data error:</strong> ' + (err.message||'Invalid JSON') +
        '<div class="muted">Tip: Check commas and quotes between entries inside the data block.</div></div>';
      entries = [];
    }

    // Build categories from primaryService + tags
    const cats=new Set();
    entries.forEach(e=>{
      if(e && e.primaryService) cats.add(String(e.primaryService).trim());
      (e && e.tags || []).forEach(t=> t && cats.add(String(t).trim()));
    });

    const state={ tokens:[], active:new Set() };

    // Chips
    Array.from(cats).sort((a,b)=>a.localeCompare(b)).forEach(cat=>{
      const chip=document.createElement("button");
      chip.className="chip"; chip.type="button"; chip.textContent=cat;
      chip.addEventListener("click",()=>{
        if(state.active.has(cat)){ state.active.delete(cat); chip.classList.remove("active"); }
        else { state.active.add(cat); chip.classList.add("active"); }
        render();
      });
      chipsEl.appendChild(chip);
    });

    // Search: require ALL tokens to match (name/service/tags/location/phone)
    function setQuery(q){
      const norm = (q||"").toLowerCase().trim();
      state.tokens = norm ? norm.split(/\s+/).filter(Boolean) : [];
      render();
    }
    qEl.addEventListener("input", ()=> setQuery(qEl.value) );
    clearBtn.addEventListener("click", ()=>{
      qEl.value=""; setQuery(""); state.active.clear(); $$(".chip.active").forEach(c=>c.classList.remove("active"));
      qEl.focus();
    });

    const esc=s=>String(s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m]));

    function textIndex(e){
      return [
        e.name||"", e.primaryService||"", (e.tags||[]).join(" "),
        e.location||"", e.phone||""
      ].join(" ").toLowerCase();
    }

    function match(e){
      const t = textIndex(e);
      const qok = state.tokens.every(tok => t.includes(tok));
      if(!qok) return false;
      if(state.active.size===0) return true;
      const tagset = new Set([e.primaryService, ...(e.tags||[])].filter(Boolean).map(s=>String(s).toLowerCase()));
      return Array.from(state.active).some(c=>tagset.has(c.toLowerCase()));
    }

    function miniLink(label, href){
      if(!href) return "";
      const safe = esc(href);
      return `<a target="_blank" rel="noopener" href="${safe}">${label}</a>`;
    }

    function card(e){
      const el=document.createElement("div");
      el.className="card";

      // Optional thumbnail (logo vs photo)
      const isLogo = !!e.isLogo;
      const thumb = e.image && String(e.image).trim()
        ? `<img class="thumb ${isLogo ? 'logo' : 'photo'}" src="${esc(e.image)}" alt="${esc(e.name||'Business')} logo or thumbnail">`
        : "";

      const tags=(e.tags||[]).map(t=>`<span class="tag">${esc(t)}</span>`).join("");

      const socials = [
        miniLink("Website", e.website),
        miniLink("Facebook", e.facebook),
        miniLink("Instagram", e.instagram),
        miniLink("X", e.x),
        miniLink("TikTok", e.tiktok),
        miniLink("Bluesky", e.bluesky),
        miniLink("YouTube", e.youtube),
        miniLink("LinkedIn", e.linkedin),
        miniLink("Book", e.booking),
        miniLink("Email", e.email),
        miniLink("WhatsApp", e.whatsapp)
      ].filter(Boolean).join("");

      const socialBlock = socials ? `<div class="socials" aria-label="Social and contact links">${socials}</div>` : "";

      const profileBtn = e.profile && String(e.profile).trim()
        ? `<a class="link" target="_blank" rel="noopener" href="${esc(e.profile)}">View Hub Profile</a>`
        : "";

      el.innerHTML = `
        ${thumb}
        <h3>${esc(e.name||"Unnamed")}</h3>
        <div class="meta">${esc(e.primaryService||"")}${e.location?` · ${esc(e.location)}`:""}</div>
        ${tags?`<div class="tagrow">${tags}</div>`:""}
        ${socialBlock}
        <div class="actions">
          ${profileBtn}
          ${e.phone?`<a class="link" href="tel:${esc(e.phone)}">Call</a>`:""}
        </div>
      `;
      return el;
    }

    function render(){
      const res = entries.filter(match);
      listEl.innerHTML = "";
      res.forEach(e=> listEl.appendChild(card(e)) );
      emptyEl.style.display = res.length ? "none" : "block";
      countEl.textContent = `${res.length} result${res.length===1?"":"s"}`;
    }

    render();
  })();
  </script>
</body>
</html>
