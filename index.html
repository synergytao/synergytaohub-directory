<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Synergy Tao Hub Directory</title>
  <style>
    body{font-family:sans-serif;margin:0;background:#f4f4f9;color:#333}
    header{background:#333;color:#fff;padding:1rem;text-align:center}
    h1{margin:0;font-size:1.8rem}
    .container{max-width:1000px;margin:20px auto;padding:0 15px}
    .search{margin-bottom:20px;display:flex;gap:10px}
    input{flex:1;padding:10px;font-size:1rem;border:1px solid #ccc;border-radius:6px}
    button{padding:10px 16px;font-size:1rem;border:none;border-radius:6px;cursor:pointer;background:#e0a800;color:#fff}
    button:hover{background:#c48f00}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
    .card{background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);display:flex;flex-direction:column}
    .card h3{margin-top:0}
    .thumb{width:100%;max-height:160px;border-radius:10px;margin-bottom:10px;background:#f4f4f4;display:block}
    .thumb.logo{object-fit:contain;padding:10px;background:#fff}
    .thumb.photo{object-fit:cover}
    .links{margin-top:auto;display:flex;flex-wrap:wrap;gap:8px}
    .links a{padding:6px 10px;background:#333;color:#fff;text-decoration:none;font-size:0.85rem;border-radius:4px}
    .links a:hover{background:#555}

    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);padding:20px;z-index:50}
    .modal.open{display:flex}
    .panel{background:#fff;max-width:720px;width:100%;max-height:90vh;border-radius:14px;border:1px solid #eee;box-shadow:0 10px 30px rgba(0,0,0,.1);display:flex;flex-direction:column}
    .panel header{padding:14px 16px;border-bottom:1px solid #eee;display:flex;gap:10px;align-items:center;justify-content:space-between;flex:0 0 auto}
    .panel .content{padding:14px 16px;display:grid;grid-template-columns:1fr 1fr;gap:10px;overflow:auto;min-height:0;flex:1 1 auto}
    .panel footer{padding:12px 16px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end;flex:0 0 auto}
    @media (max-width:640px){.panel .content{grid-template-columns:1fr}}
    body.modal-open{overflow:hidden}
  </style>
</head>
<body>
  <header>
    <h1>Synergy Tao Holistic Health Hub Directory</h1>
  </header>
  <div class="container">
    <div class="search">
      <input type="text" id="searchBox" placeholder="Search by name, service or location...">
      <button id="adminBtn">Admin</button>
    </div>
    <div class="grid" id="results"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="panel">
      <header>
        <h2>Add Directory Entry</h2>
        <button onclick="closeModal()">✖</button>
      </header>
      <div class="content" id="formContent">
        <!-- form will be injected here -->
      </div>
      <footer>
        <button onclick="saveEntry()">Save</button>
        <button onclick="closeModal()">Cancel</button>
      </footer>
    </div>
  </div>

  <script id="sth-data" type="application/json">
  [
    {
      "live": true,
      "name": "Synergy Tao",
      "primaryService": "Wing Chun & Qigong",
      "tags": ["Holistic Martial Arts","Wing Chun","Qigong","Self-Defence","Meditation","Adults"],
      "image": "https://synergytaohub.co.uk/images/academies/17941/images/0d772f2be95d.png",
      "isLogo": true,
      "website": "https://synergytao.co.uk",
      "profile": "https://synergytaohub.co.uk/page/synergy-tao",
      "facebook": "https://www.facebook.com/synergytao",
      "instagram": "https://www.instagram.com/synergy_tao",
      "x": "",
      "tiktok": "",
      "bluesky": "https://bsky.app/profile/sifudavidridgway.bsky.social",
      "youtube": "",
      "linkedin": "",
      "booking": "",
      "email": "mailto:sifudavid@synergytao.co.uk",
      "whatsapp": "https://wa.me/447956096359",
      "phone": "07956 096359",
      "location": "Telford",
      "notes": "Founder business – always live"
    },
    {
      "live": false,
      "name": "Business Name",
      "primaryService": "Main Service",
      "tags": ["Service 1", "Service 2", "Service 3"],
      "image": "https://synergytaohub.co.uk/images/academies/17941/images/your-image.jpg",
      "isLogo": false,
      "website": "https://example.com",
      "profile": "https://synergytaohub.co.uk/page/business-profile",
      "facebook": "https://facebook.com/",
      "instagram": "https://instagram.com/",
      "x": "https://x.com/",
      "tiktok": "https://tiktok.com/",
      "bluesky": "https://bsky.app/",
      "youtube": "https://youtube.com/",
      "linkedin": "https://linkedin.com/",
      "booking": "https://bookinglink.com",
      "email": "mailto:info@example.com",
      "whatsapp": "https://wa.me/447000000000",
      "phone": "07123 456789",
      "location": "Town, Shropshire",
      "notes": "Placeholder – not live until membership confirmed"
    }
  ]
  </script>

  <script>
    const data = JSON.parse(document.getElementById("sth-data").textContent);
    const results = document.getElementById("results");
    const searchBox = document.getElementById("searchBox");
    const modal = document.getElementById("modal");
    const formContent = document.getElementById("formContent");
    const ADMIN_PASS = "ST_Admin_Pass"; // change this

    let adminMode = false;

    function esc(s){return String(s||"")}
    function card(e){
      if(!e.live) return "";
      const thumb = e.image ? `<img class="thumb ${e.isLogo?'logo':'photo'}" src="${esc(e.image)}" alt="">` : "";
      let links = "";
      [["Website","website"],["Profile","profile"],["Facebook","facebook"],["Instagram","instagram"],["X","x"],["TikTok","tiktok"],["Bluesky","bluesky"],["YouTube","youtube"],["LinkedIn","linkedin"],["Booking","booking"],["Email","email"],["WhatsApp","whatsapp"],["Phone","phone"]]
      .forEach(([label,key])=>{
        if(e[key] && e[key].trim()){
          links += `<a href="${esc(e[key])}" target="_blank">${label}</a>`;
        }
      });
      return `<div class="card">
        ${thumb}
        <h3>${esc(e.name)}</h3>
        <p><strong>${esc(e.primaryService)}</strong></p>
        <p>${esc((e.tags||[]).join(", "))}</p>
        <p><em>${esc(e.location||"")}</em></p>
        <div class="links">${links}</div>
      </div>`;
    }
    function render(){
      const q = searchBox.value.toLowerCase();
      results.innerHTML = data.map(e=>{
        if(!e.live) return "";
        const hay = [e.name,e.primaryService,(e.tags||[]).join(" "),e.location].join(" ").toLowerCase();
        if(hay.includes(q)) return card(e); else return "";
      }).join("");
    }
    searchBox.addEventListener("input",render);
    render();

    // Admin mode
    document.getElementById("adminBtn").addEventListener("click",()=>{
      if(adminMode){
        openModal();
      } else {
        const p = prompt("Enter admin password:");
        if(p===ADMIN_PASS){adminMode=true;openModal();}
        else alert("Incorrect password");
      }
    });

    function openModal(){
      formContent.innerHTML = buildForm();
      modal.classList.add("open");
      document.body.classList.add("modal-open");
    }
    function closeModal(){
      modal.classList.remove("open");
      document.body.classList.remove("modal-open");
    }
    document.addEventListener("keydown",e=>{if(e.key==="Escape"&&modal.classList.contains("open")) closeModal();});

    function buildForm(){
      return `
        <label>Name<input id="fName"></label>
        <label>Primary Service<input id="fService"></label>
        <label>Tags (comma separated)<input id="fTags"></label>
        <label>Image URL<input id="fImage"></label>
        <label>Logo? <input type="checkbox" id="fLogo"></label>
        <label>Website<input id="fWebsite"></label>
        <label>Profile<input id="fProfile"></label>
        <label>Facebook<input id="fFacebook"></label>
        <label>Instagram<input id="fInstagram"></label>
        <label>X<input id="fX"></label>
        <label>TikTok<input id="fTiktok"></label>
        <label>Bluesky<input id="fBluesky"></label>
        <label>YouTube<input id="fYoutube"></label>
        <label>LinkedIn<input id="fLinkedin"></label>
        <label>Booking<input id="fBooking"></label>
        <label>Email<input id="fEmail"></label>
        <label>WhatsApp<input id="fWhatsapp"></label>
        <label>Phone<input id="fPhone"></label>
        <label>Location<input id="fLocation"></label>
        <label>Live? <input type="checkbox" id="fLive" checked></label>
        <label>Notes<textarea id="fNotes"></textarea></label>
      `;
    }
    function saveEntry(){
      const entry = {
        live: document.getElementById("fLive").checked,
        name: document.getElementById("fName").value,
        primaryService: document.getElementById("fService").value,
        tags: document.getElementById("fTags").value.split(",").map(s=>s.trim()).filter(Boolean),
        image: document.getElementById("fImage").value,
        isLogo: document.getElementById("fLogo").checked,
        website: document.getElementById("fWebsite").value,
        profile: document.getElementById("fProfile").value,
        facebook: document.getElementById("fFacebook").value,
        instagram: document.getElementById("fInstagram").value,
        x: document.getElementById("fX").value,
        tiktok: document.getElementById("fTiktok").value,
        bluesky: document.getElementById("fBluesky").value,
        youtube: document.getElementById("fYoutube").value,
        linkedin: document.getElementById("fLinkedin").value,
        booking: document.getElementById("fBooking").value,
        email: document.getElementById("fEmail").value,
        whatsapp: document.getElementById("fWhatsapp").value,
        phone: document.getElementById("fPhone").value,
        location: document.getElementById("fLocation").value,
        notes: document.getElementById("fNotes").value
      };
      data.push(entry);
      render();
      closeModal();
      alert("Entry added locally. To make permanent, update the JSON in GitHub.");
    }
  </script>
</body>
</html>
